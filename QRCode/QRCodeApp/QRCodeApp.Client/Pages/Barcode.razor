@page "/barcode"

@using Syncfusion.Blazor.BarcodeGenerator
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.DropDowns
@using System.IO
@inject NavigationManager NavigationManager
@rendermode InteractiveWebAssembly

<h3>Barcode</h3>

<MudGrid>
  <MudItem>
    <SfQRCodeGenerator @ref="_qRCodeGenerator" Width="@_barcodeWidth" Height="@_barcodeHeight" Value="@_qrcodeValue" BackgroundColor="@_backgroundColor" ForeColor="@_foreColor" Version="@_version" ErrorCorrectionLevel="@_errorCorrectionLevel">
      <QRCodeGeneratorDisplayText Text="@_qrcodeValue" Visibility="@_textVisibility">
        <QRCodeTextMargin Top="@_topTextMargin" Bottom="@_bottomTextMargin"></QRCodeTextMargin>
      </QRCodeGeneratorDisplayText>
      <QRCodeLogo ImageSource="@_base64Image"></QRCodeLogo>
      <QRMargin Left="@_leftMargin" Top="@_topMargin" Right="@_rightMargin" Bottom="@_bottomMargin"></QRMargin>
    </SfQRCodeGenerator>
  </MudItem>
  <MudItem>
    <MudStack>
      <MudText Typo="Typo.h6">Appearance</MudText>
      <MudText>Value</MudText>
      <SfTextBox Value="@_qrcodeValue" OnInput="@QRcodeValueChange" CssClass="@CssClass" Width="103%"></SfTextBox>
      <MudText>Width</MudText>
      <SfNumericTextBox TValue="double" Value="@_width" Format="n0" Decimals=0 Min=0 Step=5 Width="110%">
        <NumericTextBoxEvents TValue="double" ValueChange="BarcodeWidthChanged" />
      </SfNumericTextBox>
      <MudText>Height</MudText>
      <SfNumericTextBox TValue="double" Value="@_height" Format="n0" Decimals=0 Min=0 Step=5 Width="110%">
        <NumericTextBoxEvents TValue="double" ValueChange="BarcodeHeightChanged" />
      </SfNumericTextBox>
      <MudText>Background Color</MudText>
      <SfColorPicker @bind-Value="@_backgroundColor" ValueChange="BackgroundColorChange"></SfColorPicker>
      <MudText>Fore Color</MudText>
      <SfColorPicker @bind-Value="@_foreColor" ValueChange="ForeColorChange"></SfColorPicker>
      <MudText>Text Visibility</MudText>
      <SfCheckBox Checked="@_textVisibility" ValueChange="TextVisibilityChange" TChecked="bool"></SfCheckBox>

      <MudText Typo="Typo.h6">Margin</MudText>
      <MudText>Left</MudText>
      <SfNumericTextBox TValue="double" Value="@_leftMargin" Format="n0" Decimals=0 Min=-10 Max=30 Step=1 Width="110%">
        <NumericTextBoxEvents TValue="double" ValueChange="LeftMarginChanged" />
      </SfNumericTextBox>
      <MudText>Right</MudText>
      <SfNumericTextBox TValue="double" Value="@_rightMargin" Format="n0" Decimals=0 Min=-10 Max=30 Step=1 Width="110%">
        <NumericTextBoxEvents TValue="double" ValueChange="RightMarginChanged" />
      </SfNumericTextBox>
      <MudText>Top</MudText>
      <SfNumericTextBox TValue="double" Value="@_topMargin" Format="n0" Decimals=0 Min=-10 Max=30 Step=1 Width="110%">
        <NumericTextBoxEvents TValue="double" ValueChange="TopMarginChanged" />
      </SfNumericTextBox>
      <MudText>Bottom</MudText>
      <SfNumericTextBox TValue="double" Value="@_bottomMargin" Format="n0" Decimals=0 Min=-10 Max=30 Step=1 Width="110%">
        <NumericTextBoxEvents TValue="double" ValueChange="BottomMarginChanged" />
      </SfNumericTextBox>

      <MudText>Version</MudText>
      <SfNumericTextBox TValue="int" Value="@_vesionNo" Format="n0" Decimals=0 Min=0 Max=40 Step=1 Width="155%">
        <NumericTextBoxEvents TValue="int" ValueChange="versionChanged" />
      </SfNumericTextBox>
      <MudText>Error Correction Level</MudText>
      <SfDropDownList TValue="string" TItem="CorrectionLevel" @bind-Value="@_level" DataSource="@_correctionLevel" Width="140%">
        <DropDownListFieldSettings Value="Correction" Text="Correction"></DropDownListFieldSettings>
        <DropDownListEvents TValue="string" TItem="CorrectionLevel" ValueChange="OnErrorCorrectionLevelChanged"></DropDownListEvents>
      </SfDropDownList>
      
      <SfButton @onclick="ExportBarcode" Content="Download" iconCss="e-icons e-download"></SfButton>
    </MudStack>
  </MudItem>
</MudGrid>

@code
{
  private string _qrcodeValue = "Anthony";
  private double _width = 200;
  private double _height = 150;
  private string _barcodeWidth = "200px";
  private string _barcodeHeight = "150px";
  private string _backgroundColor = "#FFFFFF";
  private bool _textVisibility = true;
  private string _foreColor = "#00000";
  private double _leftMargin = 10;
  private double _rightMargin = 10;
  private double _topMargin = 10;
  private double _bottomMargin = 10;
  private readonly double _topTextMargin = 0;
  private readonly double _bottomTextMargin = 0;
  private SfQRCodeGenerator? _qRCodeGenerator;
  private string? CssClass { get; set; }
  private int _vesionNo = 0;
  private QRCodeVersion _version = QRCodeVersion.Auto;
  private string _level = "Low";
  private ErrorCorrectionLevel _errorCorrectionLevel = ErrorCorrectionLevel.Low;
  public class CorrectionLevel
  {
    public string? Correction { get; set; }
  }
  private readonly List<CorrectionLevel> _correctionLevel = new List<CorrectionLevel> {
    new CorrectionLevel() { Correction = "Low" },
    new CorrectionLevel() { Correction = "Medium" },
    new CorrectionLevel() { Correction = "Quartile" },
    new CorrectionLevel() { Correction = "High" },
    };
  private readonly string _base64Image = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOQAAADdCAMAAACc/C7aAAAAsVBMVEX///8rNXz2kh6uscm5vNAXJXUVI3UAGXHy8/gIG3KNkbHu7vI8RYaztswaJ3ago73V1uMmMXpMVI4eKnf1igAOH3P/+vH6wIr3oUJwdaGChqr70bD1iQD2kBT2jgAAAGz969v+8uf3pFD84Mj6xpj4qVr4snD4rmb6yJv2lij6zKP5un782Lj+9ez3mzn3nTyUl7bFxtYzPYL5tnj83MIAEW9dZJlASYnj5OzO0NxobZ11NT2/AAAEjklEQVR4nO2da1vaMBiGYz0gotucFZk0pYigKIdtypT9/x82PLWlpkneQK8k3XN/f5LcBpI3TccYAwAAAP4T+p227SFUTxAHie0xVM0VD3g4sD2KahnFwYrozvY4quQ6DF4J722PpDomUfBOOLQ9lqpIUscg4OOp7eFUwpQHOXic2B5QFYzXJFcf2YntEW2fYcFxtche2x7TtnkIi46rubyxPartcidwDIK4VjXeJBI5rpafoG97aFsjEc7jq2VtarzppzUnv/zUpMabySRrUuMNY5ljPWq8+9Iv5AfxzPca765kYc3je403UM7j20fW5xov0ZjHVzyu8dqBdGFdm8uR7cGaMtd29LfGu1FsHuvwsY813oXeopNZeljjdXUXnQzvarwB3XFleSFp8fDyiMzPNL2kh49+KRz7xM/qO7Iar9U7o7L/O02fLMjpxle5Y7v4SEcXSY3XauxQOT3OJA/I6S8KyY6ho6zGc01yRNo8CpTVeI5JUjePAiU1nluSZY909OdSWOM5JWm0eawTdwTLj0uS002+jx9EXbclTTePPKGoKHBI8moLjrHw2bo7khttHu/wubBpZyRvN9s83hwD8cnSFUmDk8dnwpJzpSuSossrKlHZqdIVSXa78VSWnymdkWSPG1pKbg3ckWQJ32QPiWXnSXckWXtmvovwWbmjU5KM3ZguP5zLHku6JckuDL+YUSJr1TFJw/0yepQ26pokG8T05Se8lbfpnCTrkw8j4YOiSfckV8cR2iLLr1QNuijJRpRFlo+V7TkpSarxYvWVupuS7FF7LsNE3Zqjkto1XqRzne6qJJvOdZafUOsy3VlJxobqj2ysd5XusKS6xlNvHu5Lsq58LjU2Dw8k2SCULT+x7qsCbktKa7zSRzq+SUpqPNF9gK+SZTWe8D7AW0l2LVpkxfcB/kqKajzeoTTggyRLigdp+SMdPyVZu1Djld0HeC1ZqPH0Nw+/JPOvTIT6m4dnktlzPPq/IvBH8uM5Hmnz8E6S9V9eZ5beB9RA8qXGK7tMrpEkG8nvA+ohyUwcvZM0ApK1keydU2mepulderpnQZJ9MyD7ExmEny1IAgAAAKCcQwO2lW7TMXJs9ZpUGvmyjpzOlXXdKKQSGf1KhM0CvUt/KTIm3IBAEpKQhCQkIQlJSEISkpCEJCQhCUlIQhKSkIQkJCEJSUhCEpKQhCQkIQlJSEISkpCEJCQhCUlIQhKSnkguTsnkJM/J4YOcZMipUH7WJCd5/J3MnzS990QOP+2m6cmsQ2Wu+NVIAAAAAAARuwak4ZZBOPtv4J43ShNo9fapHDTS9JKebv5N03sLcrpxaSTZJJ8jds4yyXN6+EcmST/DnEESktSeIKkKQ1KZhiQkqT1BUhWGpDINSUhSe4KkKgxJZRqSkKT2BElVGJLKNCQhSe0JkqowJJVpSEKS2hMkVWFIKtOQhCS1J0iqwpBUpiEJSWpPkFSFIalMQxKS1J4gqQpDUpmGJCSpPXkn2Tsgk39zmR7OvblMTy+MJNmeAdmf6IQeXqbpZ4OulyIHAAAAAABQZ/4BUpFG1g/DdfIAAAAASUVORK5CYII=";
  public void OnInvalid(ValidationFailedEventArgs args)
  {
    CssClass = "e-error";
  }
  private void BarcodeWidthChanged(Syncfusion.Blazor.Inputs.ChangeEventArgs<double> args)
  {
    _barcodeWidth = args.Value.ToString() + "px";
    _width = args.Value;
  }
  private void BarcodeHeightChanged(Syncfusion.Blazor.Inputs.ChangeEventArgs<double> args)
  {
    _barcodeHeight = args.Value.ToString() + "px";
    _height = args.Value;
  }
  public void BackgroundColorChange(ColorPickerEventArgs args)
  {
    _backgroundColor = args.CurrentValue.Hex.ToString();
  }
  public void ForeColorChange(ColorPickerEventArgs args)
  {
    _foreColor = args.CurrentValue.Hex.ToString();
  }
  public void TopMarginChanged(Syncfusion.Blazor.Inputs.ChangeEventArgs<double> args)
  {
    _topMargin = args.Value;
  }
  public void BottomMarginChanged(Syncfusion.Blazor.Inputs.ChangeEventArgs<double> args)
  {
    _bottomMargin = args.Value;
  }
  public void LeftMarginChanged(Syncfusion.Blazor.Inputs.ChangeEventArgs<double> args)
  {
    _leftMargin = args.Value;
  }
  public void RightMarginChanged(Syncfusion.Blazor.Inputs.ChangeEventArgs<double> args)
  {
    _rightMargin = args.Value;
  }
  private void QRcodeValueChange(ChangeEventArgs args)
  {
    string? value = args.Value?.ToString();
    if (string.IsNullOrWhiteSpace(value))
      return;
    _qrcodeValue = value;
  }
  private void TextVisibilityChange(Syncfusion.Blazor.Buttons.ChangeEventArgs<bool> args)
  {
    if (args.Checked)
      _textVisibility = true;
    else
      _textVisibility = false;
  }
  public void versionChanged(Syncfusion.Blazor.Inputs.ChangeEventArgs<int> args)
  {
    int value = args.Value; _vesionNo = args.Value;
    if (value >= 0 && value <= 40)
    {
      QRCodeVersion newVersion = (QRCodeVersion)value;
      if (Enum.IsDefined(typeof(QRCodeVersion), newVersion))
      {
        _version = newVersion;
      }
    }
  }
  private void OnErrorCorrectionLevelChanged(ChangeEventArgs<string, CorrectionLevel> args)
  {
    if (args.Value == "Low")
    {
      _errorCorrectionLevel = ErrorCorrectionLevel.Low;
    }
    if (args.Value == "Medium")
    {
      _errorCorrectionLevel = ErrorCorrectionLevel.Medium;
    }
    if (args.Value == "High")
    {
      _errorCorrectionLevel = ErrorCorrectionLevel.High;
    }
    if (args.Value == "Quartile")
    {
      _errorCorrectionLevel = ErrorCorrectionLevel.Quartile;
    }
  }
  private void ExportBarcode()
  {
    _qRCodeGenerator?.Export("QRCodeWithLogo", BarcodeExportType.JPG);
  }
}